Function PlayEnvSe(String file, Integer fFade)
	PUSH_VAR file
	CALL_METHOD MakeUpper
	NOP
	PUSH_VAL String "EnvSe-"
	PUSH_VAR file
	+
	CALL Debug
	NOP
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	CALL_METHOD GetType
	PUSH_VAL String "Sound"
	==
	JUMP_OK _l_32
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	GET_FIELD res
	CALL_METHOD Stop
	NOP
	PUSH_OBJ  14
	PUSH_VAR file
	CALL_METHOD Remove
	NOP
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	PUSH_VAL struct Sound struct
	POP =
	NOP
	JUMP _l_38
@_l_32:
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	PUSH_VAL struct Sound struct
	POP =
	NOP
@_l_38:
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	GET_FIELD res
	CALL_METHOD IsPlaying
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	GET_FIELD fEndingProcess
	PUSH_VAL Integer 0i
	==
	and
	JUMP_OK _l_53
	PUSH_VAL Integer 0i
	Return
@_l_53:
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	GET_FIELD filename
	PUSH_VAR file
	POP =
	NOP
	PUSH_OBJ  5
	GET_FIELD flgPlaySe
	PUSH_VAL Integer -1i
	==
	JUMP_OK _l_73
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	GET_FIELD fPlaying
	PUSH_VAL Integer -1i
	POP =
	NOP
	JUMP _l_82
@_l_73:
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	GET_FIELD fPlaying
	PUSH_VAL Integer 0i
	POP =
	NOP
	PUSH_VAL Integer 0i
	Return
@_l_82:
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	GET_FIELD res
	PUSH_VAR file
	PUSH_VAL String ".mio"
	+
	CALL_METHOD LoadSound
	NOP
	PUSH_VAR fFade
	PUSH_VAL Integer 0i
	!=
	JUMP_OK _l_132
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	GET_FIELD res
	PUSH_VAL Real 0d
	PUSH_VAL Real 0d
	CALL_METHOD SetVolume
	NOP
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	GET_FIELD res
	PUSH_VAL Integer 0i
	PUSH_VAL Integer 1i
	CALL_METHOD Play
	NOP

	INIT_LOCAL struct Bezier2D bzVol
	PUSH_VAR bzVol
	PUSH_VAL Real 0d
	PUSH_VAL Real 0d
	PUSH_OBJ  5
	GET_FIELD volSe
	PUSH_OBJ  5
	GET_FIELD volSe
	CALL_METHOD SetLinear
	NOP
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	GET_FIELD res
	PUSH_VAR bzVol
	PUSH_VAL Integer 2000i
	CALL_METHOD SetVolumeEnvelope
	NOP
	NOP
	JUMP _l_150
@_l_132:
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	GET_FIELD res
	PUSH_OBJ  5
	GET_FIELD volSe
	PUSH_OBJ  5
	GET_FIELD volSe
	CALL_METHOD SetVolume
	NOP
	PUSH_OBJ  14
	PUSH_VAR file
	GET_FIELD_BY_OFFSET
	GET_FIELD res
	PUSH_VAL Integer 0i
	PUSH_VAL Integer 1i
	CALL_METHOD Play
	NOP
@_l_150:
	PUSH_VAL Integer 0i
	Return
EndFunc

