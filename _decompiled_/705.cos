Function Save(String filename, Integer fThumb, Reference arrayHideSpr, Reference arrayShowSpr)
	PUSH_VAL String "Save:"
	PUSH_VAR filename
	+
	CALL Debug
	NOP
	INIT_LOCAL parent arrayShowTrans
	INIT_LOCAL parent arrayHideTrans
	PUSH_UNK
	CALL_METHOD Lock
	NOP
	INIT_LOCAL Integer i
	PUSH_VAR arrayHideSpr
	CALL_METHOD GetType
	PUSH_VAL String "Array"
	==
	JUMP_OK _l_45
	PUSH_VAR i
	PUSH_VAL Integer 0i
	POP =
	NOP
@_l_20:
	PUSH_VAR i
	PUSH_VAR arrayHideSpr
	CALL_METHOD GetLength
	<=
	JUMP_OK _l_45
	PUSH_VAR arrayHideTrans
	PUSH_VAR i
	GET_FIELD_BY_OFFSET
	PUSH_VAR arrayHideSpr
	PUSH_VAR i
	GET_FIELD_BY_OFFSET
	CALL_METHOD GetTransparency
	POP =
	NOP
	PUSH_VAR arrayHideSpr
	PUSH_VAR i
	GET_FIELD_BY_OFFSET
	PUSH_VAL Integer 256i
	CALL_METHOD SetTransparency
	NOP
	PUSH_VAR i
	PUSH_VAL Integer 1i
	POP +=
	NOP
	JUMP _l_20
@_l_45:
	PUSH_VAR arrayShowSpr
	CALL_METHOD GetType
	PUSH_VAL String "Array"
	==
	JUMP_OK _l_79
	PUSH_VAR i
	PUSH_VAL Integer 0i
	POP =
	NOP
@_l_54:
	PUSH_VAR i
	PUSH_VAR arrayShowSpr
	CALL_METHOD GetLength
	<=
	JUMP_OK _l_79
	PUSH_VAR arrayShowTrans
	PUSH_VAR i
	GET_FIELD_BY_OFFSET
	PUSH_VAR arrayShowSpr
	PUSH_VAR i
	GET_FIELD_BY_OFFSET
	CALL_METHOD GetTransparency
	POP =
	NOP
	PUSH_VAR arrayShowSpr
	PUSH_VAR i
	GET_FIELD_BY_OFFSET
	PUSH_VAL Integer 0i
	CALL_METHOD SetTransparency
	NOP
	PUSH_VAR i
	PUSH_VAL Integer 1i
	POP +=
	NOP
	JUMP _l_54
@_l_79:
	PUSH_UNK
	CALL_METHOD Refresh
	NOP
	INIT_LOCAL struct Sprite sprScreen
	PUSH_VAR sprScreen
	PUSH_VAL Integer 67108865i
	PUSH_OBJ  2
	GET_FIELD w
	PUSH_OBJ  2
	GET_FIELD h
	CALL_METHOD CreateSprite
	NOP
	INIT_LOCAL struct SpriteParam param
	PUSH_UNK
	PUSH_VAR param
	CALL_METHOD GetParameter
	NOP
	PUSH_VAR sprScreen
	PUSH_UNK
	PUSH_VAR param
	CALL_METHOD DrawImage
	NOP
	PUSH_OBJ  4
	GET_FIELD cg
	PUSH_OBJ  10
	GET_FIELD cg
	POP =
	NOP
	PUSH_OBJ  4
	GET_FIELD fCgRGB
	PUSH_OBJ  10
	GET_FIELD fSetCgRGB
	POP =
	NOP
	PUSH_OBJ  4
	GET_FIELD colSetCgRGB
	PUSH_OBJ  10
	GET_FIELD colSetCgRGB
	POP =
	NOP
	PUSH_OBJ  4
	GET_FIELD bustup
	PUSH_OBJ  10
	GET_FIELD bustupMan
	GET_FIELD info
	POP =
	NOP
	PUSH_OBJ  4
	GET_FIELD fToneFilter
	PUSH_OBJ  10
	CALL_METHOD isToneFilter
	POP =
	NOP
	PUSH_OBJ  4
	GET_FIELD toneFilter
	PUSH_OBJ  10
	CALL_METHOD getToneFilter
	POP =
	NOP
	PUSH_OBJ  4
	GET_FIELD viewType
	PUSH_OBJ  10
	CALL_METHOD getMessageView
	POP =
	NOP
	PUSH_OBJ  4
	GET_FIELD fZoom
	PUSH_OBJ  10
	CALL_METHOD isZoom
	POP =
	NOP
	PUSH_OBJ  4
	GET_FIELD zoomParam
	PUSH_OBJ  10
	CALL_METHOD getZoomParam
	POP =
	NOP
	PUSH_OBJ  4
	GET_FIELD playBgm
	CALL GetPlayBgmName
	POP =
	NOP
	PUSH_OBJ  4
	GET_FIELD fPauseBgm
	CALL IsPauseBgm
	POP =
	NOP
	PUSH_OBJ  4
	GET_FIELD playEnvSe
	CALL_METHOD Remove
	NOP
	PUSH_OBJ  4
	GET_FIELD playEnvSe
	CALL GetPlayEnvSeList
	NOP
	INIT_LOCAL Integer fHScene
	PUSH_OBJ  4
	GET_FIELD cg
	GET_FIELD filename
	CALL IsHScene
	POP =
	INIT_LOCAL struct File file
	PUSH_VAR file
	PUSH_VAR filename
	PUSH_VAL String ".dat"
	+
	PUSH_VAL Integer 5i
	PUSH_VAL Integer 4i
	or
	CALL_METHOD Open
	NOP
	PUSH_VAR fHScene
	PUSH_VAL Integer 0i
	==
	JUMP_OK _l_205
	PUSH_VAR fThumb
	PUSH_VAL Integer -1i
	==
	JUMP_OK _l_204
	PUSH_VAR file
	PUSH_VAR sprScreen
	PUSH_VAL Integer 120i
	PUSH_VAL Integer 90i
	CALL_METHOD SaveThumbnailImage
	NOP
@_l_204:
	JUMP _l_228
@_l_205:

	INIT_LOCAL struct Sprite sprThumb
	PUSH_VAR sprThumb
	PUSH_OBJ  4
	GET_FIELD cg
	GET_FIELD filename
	PUSH_VAL Integer 4i
	CALL_METHOD Left
	PUSH_VAL String "thm.eri"
	+
	CALL_METHOD LoadImage
	NOP
	PUSH_VAR fThumb
	PUSH_VAL Integer -1i
	==
	JUMP_OK _l_227
	PUSH_VAR file
	PUSH_VAR sprThumb
	PUSH_VAL Integer 120i
	PUSH_VAL Integer 90i
	CALL_METHOD SaveThumbnailImage
	NOP
@_l_227:
	NOP
@_l_228:
	PUSH_VAR file
	PUSH_OBJ  4
	CALL_METHOD SaveObject
	NOP
	PUSH_VAR file
	CALL_METHOD Close
	NOP
	PUSH_VAL Integer 0i
	PUSH_VAL Integer -1i
	==
	JUMP_OK _l_242
	PUSH_VAL String "_save.log"
	CALL DumpContext
	NOP
@_l_242:
	PUSH_VAR arrayHideSpr
	CALL_METHOD GetType
	PUSH_VAL String "Array"
	==
	JUMP_OK _l_269
	PUSH_VAR i
	PUSH_VAL Integer 0i
	POP =
	NOP
@_l_251:
	PUSH_VAR i
	PUSH_VAR arrayHideSpr
	CALL_METHOD GetLength
	<=
	JUMP_OK _l_269
	PUSH_VAR arrayHideSpr
	PUSH_VAR i
	GET_FIELD_BY_OFFSET
	PUSH_VAR arrayHideTrans
	PUSH_VAR i
	GET_FIELD_BY_OFFSET
	CALL_METHOD SetTransparency
	NOP
	PUSH_VAR i
	PUSH_VAL Integer 1i
	POP +=
	NOP
	JUMP _l_251
@_l_269:
	PUSH_VAR arrayShowSpr
	CALL_METHOD GetType
	PUSH_VAL String "Array"
	==
	JUMP_OK _l_296
	PUSH_VAR i
	PUSH_VAL Integer 0i
	POP =
	NOP
@_l_278:
	PUSH_VAR i
	PUSH_VAR arrayShowSpr
	CALL_METHOD GetLength
	<=
	JUMP_OK _l_296
	PUSH_VAR arrayShowSpr
	PUSH_VAR i
	GET_FIELD_BY_OFFSET
	PUSH_VAR arrayShowTrans
	PUSH_VAR i
	GET_FIELD_BY_OFFSET
	CALL_METHOD SetTransparency
	NOP
	PUSH_VAR i
	PUSH_VAL Integer 1i
	POP +=
	NOP
	JUMP _l_278
@_l_296:
	PUSH_UNK
	CALL_METHOD Unlock
	NOP
	PUSH_VAL Integer 0i
	Return
EndFunc

